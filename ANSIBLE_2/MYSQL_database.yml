- hosts: servers
  become: yes
  tasks:
    - name: Ensure that MariaDB is installed
      yum: name='{{ item }}' state=present
      with_items:
        - mariadb-server
        - MySQL-python
    - name: Ensure that Mariadb is started and enabled
      service: name=mariadb state=started enabled=yes
    - name: Upload the .my.cnf file to save the credentials
      copy:
        src: /etc/ansible/my.cnf
        dest: /root/.my.cnf
        owner: root
        mode: 0600
    - name: Create application database
      mysql_db:
        name: ci_database
        state: present
    - name: Create an application user
      mysql_user:
        name: ci_user
        password: cipassword
        host: '%'
        priv: ci_database.*:ALL
        state: present
